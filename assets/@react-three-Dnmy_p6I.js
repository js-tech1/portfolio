import{r as d,j as q}from"./react-CKr7Zwl9.js";import{L as Re,T as Ht,R as Nt,U as Wt,a as Bt,O as $e,P as Ue,S as Qe,b as Oe,N as $t,A as Ut,B as Gt,M as Vt,C as dt,V,c as Ge,W as qt,d as Zt,e as Xt,f as Yt,g as Kt,h as Jt,i as Qt,D as en,j as _e,k as tn,l as nn,m as rn,n as He,o as ce,p as on,q as an}from"./three-BpMn_lgO.js";import{u as sn}from"./react-use-measure-FPX0rXyh.js";import{F as ln,u as cn}from"./its-fine-B1_Vhwlw.js";import{R as un,c as le}from"./react-reconciler-CkkvoCq-.js";import{_ as te}from"./@babel-CF3RwP-h.js";import{c as fn}from"./react-dom-CPHucPct.js";import{c as pt}from"./zustand-DLJcl_tw.js";import"./maath-BEABJQwW.js";import{G as Ve,D as dn,M as je,O as pn}from"./three-stdlib-ngbH9uKm.js";import{s as vn,p as mn,c as hn}from"./suspend-react-BKIKQNXN.js";function pr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function vr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),n}var vt={exports:{}},mt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,S){var E=b.length;b.push(S);e:for(;0<E;){var x=E-1>>>1,k=b[x];if(0<s(k,S))b[x]=S,b[E]=k,E=x;else break e}}function n(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var S=b[0],E=b.pop();if(E!==S){b[0]=E;e:for(var x=0,k=b.length,j=k>>>1;x<j;){var W=2*(x+1)-1,U=b[W],X=W+1,ne=b[X];if(0>s(U,E))X<k&&0>s(ne,U)?(b[x]=ne,b[X]=E,x=X):(b[x]=U,b[W]=E,x=W);else if(X<k&&0>s(ne,E))b[x]=ne,b[X]=E,x=X;else break e}}return S}function s(b,S){var E=b.sortIndex-S.sortIndex;return E!==0?E:b.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var h=Date,g=h.now();e.unstable_now=function(){return h.now()-g}}var c=[],p=[],r=1,o=null,l=3,m=!1,v=!1,P=!1,f=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(b){for(var S=n(p);S!==null;){if(S.callback===null)i(p);else if(S.startTime<=b)i(p),S.sortIndex=S.expirationTime,t(c,S);else break;S=n(p)}}function O(b){if(P=!1,M(b),!v)if(n(c)!==null)v=!0,$(C);else{var S=n(p);S!==null&&H(O,S.startTime-b)}}function C(b,S){v=!1,P&&(P=!1,u(A),A=-1),m=!0;var E=l;try{for(M(S),o=n(c);o!==null&&(!(o.expirationTime>S)||b&&!w());){var x=o.callback;if(typeof x=="function"){o.callback=null,l=o.priorityLevel;var k=x(o.expirationTime<=S);S=e.unstable_now(),typeof k=="function"?o.callback=k:o===n(c)&&i(c),M(S)}else i(c);o=n(c)}if(o!==null)var j=!0;else{var W=n(p);W!==null&&H(O,W.startTime-S),j=!1}return j}finally{o=null,l=E,m=!1}}var _=!1,T=null,A=-1,R=5,D=-1;function w(){return!(e.unstable_now()-D<R)}function L(){if(T!==null){var b=e.unstable_now();D=b;var S=!0;try{S=T(!0,b)}finally{S?N():(_=!1,T=null)}}else _=!1}var N;if(typeof y=="function")N=function(){y(L)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,z=Z.port2;Z.port1.onmessage=L,N=function(){z.postMessage(null)}}else N=function(){f(L,0)};function $(b){T=b,_||(_=!0,N())}function H(b,S){A=f(function(){b(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){v||m||(v=!0,$(C))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return l},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(b){switch(l){case 1:case 2:case 3:var S=3;break;default:S=l}var E=l;l=S;try{return b()}finally{l=E}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,S){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var E=l;l=b;try{return S()}finally{l=E}},e.unstable_scheduleCallback=function(b,S,E){var x=e.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?x+E:x):E=x,b){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=E+k,b={id:r++,callback:S,priorityLevel:b,startTime:E,expirationTime:k,sortIndex:-1},E>x?(b.sortIndex=E,t(p,b),n(c)===null&&b===n(p)&&(P?(u(A),A=-1):P=!0,H(O,E-x))):(b.sortIndex=k,t(c,b),v||m||(v=!0,$(C))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var S=l;return function(){var E=l;l=S;try{return b.apply(this,arguments)}finally{l=E}}}})(mt);vt.exports=mt;var et=vt.exports;const qe={},gn=e=>void Object.assign(qe,e);function yn(e,t){function n(r,{args:o=[],attach:l,...m},v){let P=`${r[0].toUpperCase()}${r.slice(1)}`,f;if(r==="primitive"){if(m.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const u=m.object;f=ae(u,{type:r,root:v,attach:l,primitive:!0})}else{const u=qe[P];if(!u)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");f=ae(new u(...o),{type:r,root:v,attach:l,memoizedProps:{args:o}})}return f.__r3f.attach===void 0&&(f instanceof Gt?f.__r3f.attach="geometry":f instanceof Vt&&(f.__r3f.attach="material")),P!=="inject"&&Ae(f,m),f}function i(r,o){let l=!1;if(o){var m,v;(m=o.__r3f)!=null&&m.attach?ke(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),l=!0),l||(v=r.__r3f)==null||v.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=r,We(o),se(o)}}function s(r,o,l){let m=!1;if(o){var v,P;if((v=o.__r3f)!=null&&v.attach)ke(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:o});const f=r.children.filter(y=>y!==o),u=f.indexOf(l);r.children=[...f.slice(0,u),o,...f.slice(u)],m=!0}m||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=r,We(o),se(o)}}function a(r,o,l=!1){r&&[...r].forEach(m=>h(o,m,l))}function h(r,o,l){if(o){var m,v,P;if(o.__r3f&&(o.__r3f.parent=null),(m=r.__r3f)!=null&&m.objects&&(r.__r3f.objects=r.__r3f.objects.filter(O=>O!==o)),(v=o.__r3f)!=null&&v.attach)it(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var f;r.remove(o),(f=o.__r3f)!=null&&f.root&&xn(Ce(o),o)}const y=(P=o.__r3f)==null?void 0:P.primitive,M=!y&&(l===void 0?o.dispose!==null:l);if(!y){var u;a((u=o.__r3f)==null?void 0:u.objects,o,M),a(o.children,o,M)}if(delete o.__r3f,M&&o.dispose&&o.type!=="Scene"){const O=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?et.unstable_scheduleCallback(et.unstable_IdlePriority,O):O()}se(r)}}function g(r,o,l,m){var v;const P=(v=r.__r3f)==null?void 0:v.parent;if(!P)return;const f=n(o,l,r.__r3f.root);if(r.children){for(const u of r.children)u.__r3f&&i(f,u);r.children=r.children.filter(u=>!u.__r3f)}r.__r3f.objects.forEach(u=>i(f,u)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||h(P,r),f.parent&&(f.__r3f.autoRemovedBeforeAppend=!0),i(P,f),f.raycast&&f.__r3f.eventCount&&Ce(f).getState().internal.interaction.push(f),[m,m.alternate].forEach(u=>{u!==null&&(u.stateNode=f,u.ref&&(typeof u.ref=="function"?u.ref(f):u.ref.current=f))})}const c=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:un({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const l=r.getState().scene;l.__r3f&&(l.__r3f.root=r,i(l,o))},removeChildFromContainer:(r,o)=>{o&&h(r.getState().scene,o)},insertInContainerBefore:(r,o,l)=>{if(!o||!l)return;const m=r.getState().scene;m.__r3f&&s(m,o,l)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,l,m){var v;if(((v=r==null?void 0:r.__r3f)!=null?v:{}).primitive&&m.object&&m.object!==r)return[!0];{const{args:f=[],children:u,...y}=m,{args:M=[],children:O,...C}=l;if(!Array.isArray(f))throw new Error("R3F: the args prop must be an array!");if(f.some((T,A)=>T!==M[A]))return[!0];const _=Pt(r,y,C,!0);return _.changes.length?[!1,_]:null}},commitUpdate(r,[o,l],m,v,P,f){o?g(r,m,P,f):Ae(r,l)},commitMount(r,o,l,m){var v;const P=(v=r.__r3f)!=null?v:{};r.raycast&&P.handlers&&P.eventCount&&Ce(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>ae(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:l,parent:m}=(o=r.__r3f)!=null?o:{};l&&m&&it(m,r,l),r.isObject3D&&(r.visible=!1),se(r)},unhideInstance(r,o){var l;const{attach:m,parent:v}=(l=r.__r3f)!=null?l:{};m&&v&&ke(v,r,m),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),se(r)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():le.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&F.fun(performance.now)?performance.now:F.fun(Date.now)?Date.now:()=>0,scheduleTimeout:F.fun(setTimeout)?setTimeout:void 0,cancelTimeout:F.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var tt,nt;const Te=e=>"colorSpace"in e||"outputColorSpace"in e,ht=()=>{var e;return(e=qe.ColorManagement)!=null?e:null},gt=e=>e&&e.isOrthographicCamera,bn=e=>e&&e.hasOwnProperty("current"),ge=typeof window<"u"&&((tt=window.document)!=null&&tt.createElement||((nt=window.navigator)==null?void 0:nt.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function yt(e){const t=d.useRef(e);return ge(()=>void(t.current=e),[e]),t}function wn({set:e}){return ge(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class bt extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}bt.getDerivedStateFromError=()=>({error:!0});const wt="__default",rt=new Map,_n=e=>e&&!!e.memoized&&!!e.changes;function _t(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const pe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ce(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const F={obj:e=>e===Object(e)&&!F.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(F.str(e)||F.num(e)||F.boo(e))return e===t;const a=F.obj(e);if(a&&i==="reference")return e===t;const h=F.arr(e);if(h&&n==="reference")return e===t;if((h||a)&&e===t)return!0;let g;for(g in e)if(!(g in t))return!1;if(a&&n==="shallow"&&i==="shallow"){for(g in s?t:e)if(!F.equ(e[g],t[g],{strict:s,objects:"reference"}))return!1}else for(g in s?t:e)if(e[g]!==t[g])return!1;if(F.und(g)){if(h&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Pn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function En(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ae(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ne(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((a,h)=>a[h],e),{target:n,key:s}}else return{target:n,key:t}}const ot=/-\d+$/;function ke(e,t,n){if(F.str(n)){if(ot.test(n)){const a=n.replace(ot,""),{target:h,key:g}=Ne(e,a);Array.isArray(h[g])||(h[g]=[])}const{target:i,key:s}=Ne(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function it(e,t,n){var i,s;if(F.str(n)){const{target:a,key:h}=Ne(e,n),g=t.__r3f.previousAttach;g===void 0?delete a[h]:a[h]=g}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function Pt(e,{children:t,key:n,ref:i,...s},{children:a,key:h,ref:g,...c}={},p=!1){const r=e.__r3f,o=Object.entries(s),l=[];if(p){const v=Object.keys(c);for(let P=0;P<v.length;P++)s.hasOwnProperty(v[P])||o.unshift([v[P],wt+"remove"])}o.forEach(([v,P])=>{var f;if((f=e.__r3f)!=null&&f.primitive&&v==="object"||F.equ(P,c[v]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(v))return l.push([v,P,!0,[]]);let u=[];v.includes("-")&&(u=v.split("-")),l.push([v,P,!1,u]);for(const y in s){const M=s[y];y.startsWith(`${v}-`)&&l.push([y,M,!1,y.split("-")])}});const m={...s};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(m.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(m.attach=r.memoizedProps.attach),{memoized:m,changes:l}}const Mn=typeof process<"u"&&!1;function Ae(e,t){var n;const i=e.__r3f,s=i==null?void 0:i.root,a=s==null||s.getState==null?void 0:s.getState(),{memoized:h,changes:g}=_n(t)?t:Pt(e,t),c=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=h);for(let r=0;r<g.length;r++){let[o,l,m,v]=g[r];if(Te(e)){const y="srgb",M="srgb-linear";o==="encoding"?(o="colorSpace",l=l===3001?y:M):o==="outputEncoding"&&(o="outputColorSpace",l=l===3001?y:M)}let P=e,f=P[o];if(v.length&&(f=v.reduce((u,y)=>u[y],e),!(f&&f.set))){const[u,...y]=v.reverse();P=y.reverse().reduce((M,O)=>M[O],e),o=u}if(l===wt+"remove")if(P.constructor){let u=rt.get(P.constructor);u||(u=new P.constructor,rt.set(P.constructor,u)),l=u[o]}else l=0;if(m&&i)l?i.handlers[o]=l:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Re)){if(Array.isArray(l))f.fromArray?f.fromArray(l):f.set(...l);else if(f.copy&&l&&l.constructor&&(Mn?f.constructor.name===l.constructor.name:f.constructor===l.constructor))f.copy(l);else if(l!==void 0){const u=f instanceof dt;!u&&f.setScalar?f.setScalar(l):f instanceof Re&&l instanceof Re?f.mask=l.mask:f.set(l),!ht()&&a&&!a.linear&&u&&f.convertSRGBToLinear()}}else if(P[o]=l,P[o]instanceof Ht&&P[o].format===Nt&&P[o].type===Wt&&a){const u=P[o];Te(u)&&Te(a.gl)?u.colorSpace=a.gl.outputColorSpace:u.encoding=a.gl.outputEncoding}se(e)}if(i&&i.parent&&e.raycast&&c!==i.eventCount){const r=Ce(e).getState().internal,o=r.interaction.indexOf(e);o>-1&&r.interaction.splice(o,1),i.eventCount&&r.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(n=e.__r3f)!=null&&n.parent&&We(e),e}function se(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function Cn(e,t){e.manual||(gt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Pe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Sn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return le.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return le.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return le.ContinuousEventPriority;default:return le.DefaultEventPriority}}function Et(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function xn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{Et(n.capturedMap,t,i,s)})}function Rn(e){function t(c){const{internal:p}=e.getState(),r=c.offsetX-p.initialClick[0],o=c.offsetY-p.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(c){return c.filter(p=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=p.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(c,p){const r=e.getState(),o=new Set,l=[],m=p?p(r.internal.interaction):r.internal.interaction;for(let u=0;u<m.length;u++){const y=pe(m[u]);y&&(y.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(c,r);function v(u){const y=pe(u);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var M;y.events.compute==null||y.events.compute(c,y,(M=y.previousRoot)==null?void 0:M.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(u,!0):[]}let P=m.flatMap(v).sort((u,y)=>{const M=pe(u.object),O=pe(y.object);return!M||!O?u.distance-y.distance:O.events.priority-M.events.priority||u.distance-y.distance}).filter(u=>{const y=Pe(u);return o.has(y)?!1:(o.add(y),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const u of P){let y=u.object;for(;y;){var f;(f=y.__r3f)!=null&&f.eventCount&&l.push({...u,eventObject:y}),y=y.parent}}if("pointerId"in c&&r.internal.capturedMap.has(c.pointerId))for(let u of r.internal.capturedMap.get(c.pointerId).values())o.has(Pe(u.intersection))||l.push(u.intersection);return l}function s(c,p,r,o){const l=e.getState();if(c.length){const m={stopped:!1};for(const v of c){const P=pe(v.object)||l,{raycaster:f,pointer:u,camera:y,internal:M}=P,O=new V(u.x,u.y,0).unproject(y),C=D=>{var w,L;return(w=(L=M.capturedMap.get(D))==null?void 0:L.has(v.eventObject))!=null?w:!1},_=D=>{const w={intersection:v,target:p.target};M.capturedMap.has(D)?M.capturedMap.get(D).set(v.eventObject,w):M.capturedMap.set(D,new Map([[v.eventObject,w]])),p.target.setPointerCapture(D)},T=D=>{const w=M.capturedMap.get(D);w&&Et(M.capturedMap,v.eventObject,w,D)};let A={};for(let D in p){let w=p[D];typeof w!="function"&&(A[D]=w)}let R={...v,...A,pointer:u,intersections:c,stopped:m.stopped,delta:r,unprojectedPoint:O,ray:f.ray,camera:y,stopPropagation(){const D="pointerId"in p&&M.capturedMap.get(p.pointerId);if((!D||D.has(v.eventObject))&&(R.stopped=m.stopped=!0,M.hovered.size&&Array.from(M.hovered.values()).find(w=>w.eventObject===v.eventObject))){const w=c.slice(0,c.indexOf(v));a([...w,v])}},target:{hasPointerCapture:C,setPointerCapture:_,releasePointerCapture:T},currentTarget:{hasPointerCapture:C,setPointerCapture:_,releasePointerCapture:T},nativeEvent:p};if(o(R),m.stopped===!0)break}}return c}function a(c){const{internal:p}=e.getState();for(const r of p.hovered.values())if(!c.length||!c.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const l=r.eventObject.__r3f,m=l==null?void 0:l.handlers;if(p.hovered.delete(Pe(r)),l!=null&&l.eventCount){const v={...r,intersections:c};m.onPointerOut==null||m.onPointerOut(v),m.onPointerLeave==null||m.onPointerLeave(v)}}}function h(c,p){for(let r=0;r<p.length;r++){const o=p[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(c)}}function g(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return p=>{const{internal:r}=e.getState();"pointerId"in p&&r.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(p.pointerId)&&(r.capturedMap.delete(p.pointerId),a([]))})}}return function(r){const{onPointerMissed:o,internal:l}=e.getState();l.lastEvent.current=r;const m=c==="onPointerMove",v=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",f=i(r,m?n:void 0),u=v?t(r):0;c==="onPointerDown"&&(l.initialClick=[r.offsetX,r.offsetY],l.initialHits=f.map(M=>M.eventObject)),v&&!f.length&&u<=2&&(h(r,l.interaction),o&&o(r)),m&&a(f);function y(M){const O=M.eventObject,C=O.__r3f,_=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(m){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const T=Pe(M),A=l.hovered.get(T);A?A.stopped&&M.stopPropagation():(l.hovered.set(T,M),_.onPointerOver==null||_.onPointerOver(M),_.onPointerEnter==null||_.onPointerEnter(M))}_.onPointerMove==null||_.onPointerMove(M)}else{const T=_[c];T?(!v||l.initialHits.includes(O))&&(h(r,l.interaction.filter(A=>!l.initialHits.includes(A))),T(M)):v&&l.initialHits.includes(O)&&h(r,l.interaction.filter(A=>!l.initialHits.includes(A)))}}s(f,r,u,y)}}return{handlePointer:g}}const Mt=e=>!!(e!=null&&e.render),Ct=d.createContext(null),On=(e,t)=>{const n=pt((g,c)=>{const p=new V,r=new V,o=new V;function l(u=c().camera,y=r,M=c().size){const{width:O,height:C,top:_,left:T}=M,A=O/C;y instanceof V?o.copy(y):o.set(...y);const R=u.getWorldPosition(p).distanceTo(o);if(gt(u))return{width:O/u.zoom,height:C/u.zoom,top:_,left:T,factor:1,distance:R,aspect:A};{const D=u.fov*Math.PI/180,w=2*Math.tan(D/2)*R,L=w*(O/C);return{width:L,height:w,top:_,left:T,factor:O/L,distance:R,aspect:A}}}let m;const v=u=>g(y=>({performance:{...y.performance,current:u}})),P=new Ge;return{set:g,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(u=1)=>e(c(),u),advance:(u,y)=>t(u,y,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Jt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const u=c();m&&clearTimeout(m),u.performance.current!==u.performance.min&&v(u.performance.min),m=setTimeout(()=>v(c().performance.max),u.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:u=>g(y=>({...y,events:{...y.events,...u}})),setSize:(u,y,M,O,C)=>{const _=c().camera,T={width:u,height:y,top:O||0,left:C||0,updateStyle:M};g(A=>({size:T,viewport:{...A.viewport,...l(_,r,T)}}))},setDpr:u=>g(y=>{const M=_t(u);return{viewport:{...y.viewport,dpr:M,initialDpr:y.viewport.initialDpr||M}}}),setFrameloop:(u="always")=>{const y=c().clock;y.stop(),y.elapsedTime=0,u!=="never"&&(y.start(),y.elapsedTime=0),g(()=>({frameloop:u}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(u,y,M)=>{const O=c().internal;return O.priority=O.priority+(y>0?1:0),O.subscribers.push({ref:u,priority:y,store:M}),O.subscribers=O.subscribers.sort((C,_)=>C.priority-_.priority),()=>{const C=c().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(y>0?1:0),C.subscribers=C.subscribers.filter(_=>_.ref!==u))}}}}}),i=n.getState();let s=i.size,a=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:g,size:c,viewport:p,gl:r,set:o}=n.getState();if(c.width!==s.width||c.height!==s.height||p.dpr!==a){var l;s=c,a=p.dpr,Cn(g,c),r.setPixelRatio(p.dpr);const m=(l=c.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(c.width,c.height,m)}g!==h&&(h=g,o(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(g)}})))}),n.subscribe(g=>e(g)),n};let Ee,jn=new Set,Tn=new Set,kn=new Set;function Le(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ve(e,t){switch(e){case"before":return Le(jn,t);case"after":return Le(Tn,t);case"tail":return Le(kn,t)}}let De,Fe;function Ie(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,Ee=0;Ee<De.length;Ee++)Fe=De[Ee],Fe.ref.current(Fe.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function An(e){let t=!1,n=!1,i,s,a;function h(p){s=requestAnimationFrame(h),t=!0,i=0,ve("before",p),n=!0;for(const o of e.values()){var r;a=o.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((r=a.gl.xr)!=null&&r.isPresenting)&&(i+=Ie(p,a))}if(n=!1,ve("after",p),i===0)return ve("tail",p),t=!1,cancelAnimationFrame(s)}function g(p,r=1){var o;if(!p)return e.forEach(l=>g(l.store.getState(),r));(o=p.gl.xr)!=null&&o.isPresenting||!p.internal.active||p.frameloop==="never"||(r>1?p.internal.frames=Math.min(60,p.internal.frames+r):n?p.internal.frames=2:p.internal.frames=1,t||(t=!0,requestAnimationFrame(h)))}function c(p,r=!0,o,l){if(r&&ve("before",p),o)Ie(p,o,l);else for(const m of e.values())Ie(p,m.store.getState());r&&ve("after",p)}return{loop:h,invalidate:g,advance:c}}function St(){const e=d.useContext(Ct);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function B(e=n=>n,t){return St()(e,t)}function fe(e,t=0){const n=St(),i=n.getState().internal.subscribe,s=yt(e);return ge(()=>i(s,t,n),[t,i,n]),null}const at=new WeakMap;function xt(e,t){return function(n,...i){let s=at.get(n);return s||(s=new n,at.set(n,s)),e&&e(s),Promise.all(i.map(a=>new Promise((h,g)=>s.load(a,c=>{c.scene&&Object.assign(c,Pn(c.scene)),h(c)},t,c=>g(new Error(`Could not load ${a}: ${c==null?void 0:c.message}`))))))}}function ye(e,t,n,i){const s=Array.isArray(t)?t:[t],a=vn(xt(n,i),[e,...s],{equal:F.equ});return Array.isArray(t)?a:a[0]}ye.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return mn(xt(n),[e,...i])};ye.clear=function(e,t){const n=Array.isArray(t)?t:[t];return hn([e,...n])};const ue=new Map,{invalidate:st,advance:lt}=An(ue),{reconciler:Se,applyProps:oe}=yn(ue,Sn),ie={objects:"shallow",strict:!1},Ln=(e,t)=>{const n=typeof e=="function"?e(t):e;return Mt(n)?n:new qt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Dn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:a,left:h,updateStyle:g=n}=t;return{width:i,height:s,top:a,left:h,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:a,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:a,left:h,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Fn(e){const t=ue.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,a=i||On(st,lt),h=n||Se.createContainer(a,le.ConcurrentRoot,null,!1,null,"",s,null);t||ue.set(e,{fiber:h,store:a});let g,c=!1,p;return{configure(r={}){let{gl:o,size:l,scene:m,events:v,onCreated:P,shadows:f=!1,linear:u=!1,flat:y=!1,legacy:M=!1,orthographic:O=!1,frameloop:C="always",dpr:_=[1,2],performance:T,raycaster:A,camera:R,onPointerMissed:D}=r,w=a.getState(),L=w.gl;w.gl||w.set({gl:L=Ln(o,e)});let N=w.raycaster;N||w.set({raycaster:N=new Bt});const{params:Z,...z}=A||{};if(F.equ(z,N,ie)||oe(N,{...z}),F.equ(Z,N.params,ie)||oe(N,{params:{...N.params,...Z}}),!w.camera||w.camera===p&&!F.equ(p,R,ie)){p=R;const E=R instanceof Zt,x=E?R:O?new $e(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);E||(x.position.z=5,R&&(oe(x,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(x.manual=!0,x.updateProjectionMatrix())),!w.camera&&!(R!=null&&R.rotation)&&x.lookAt(0,0,0)),w.set({camera:x}),N.camera=x}if(!w.scene){let E;m instanceof Qe?E=m:(E=new Qe,m&&oe(E,m)),w.set({scene:ae(E)})}if(!w.xr){var $;const E=(j,W)=>{const U=a.getState();U.frameloop!=="never"&&lt(j,!0,U,W)},x=()=>{const j=a.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?E:null),j.gl.xr.isPresenting||st(j)},k={connect(){const j=a.getState().gl;j.xr.addEventListener("sessionstart",x),j.xr.addEventListener("sessionend",x)},disconnect(){const j=a.getState().gl;j.xr.removeEventListener("sessionstart",x),j.xr.removeEventListener("sessionend",x)}};typeof(($=L.xr)==null?void 0:$.addEventListener)=="function"&&k.connect(),w.set({xr:k})}if(L.shadowMap){const E=L.shadowMap.enabled,x=L.shadowMap.type;if(L.shadowMap.enabled=!!f,F.boo(f))L.shadowMap.type=Oe;else if(F.str(f)){var H;const k={basic:Xt,percentage:Yt,soft:Oe,variance:Kt};L.shadowMap.type=(H=k[f])!=null?H:Oe}else F.obj(f)&&Object.assign(L.shadowMap,f);(E!==L.shadowMap.enabled||x!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const b=ht();b&&("enabled"in b?b.enabled=!M:"legacyMode"in b&&(b.legacyMode=M)),c||oe(L,{outputEncoding:u?3e3:3001,toneMapping:y?$t:Ut}),w.legacy!==M&&w.set(()=>({legacy:M})),w.linear!==u&&w.set(()=>({linear:u})),w.flat!==y&&w.set(()=>({flat:y})),o&&!F.fun(o)&&!Mt(o)&&!F.equ(o,L,ie)&&oe(L,o),v&&!w.events.handlers&&w.set({events:v(a)});const S=Dn(e,l);return F.equ(S,w.size,ie)||w.setSize(S.width,S.height,S.updateStyle,S.top,S.left),_&&w.viewport.dpr!==_t(_)&&w.setDpr(_),w.frameloop!==C&&w.setFrameloop(C),w.onPointerMissed||w.set({onPointerMissed:D}),T&&!F.equ(T,w.performance,ie)&&w.set(E=>({performance:{...E.performance,...T}})),g=P,c=!0,this},render(r){return c||this.configure(),Se.updateContainer(q.jsx(In,{store:a,children:r,onCreated:g,rootElement:e}),h,null,()=>{}),a},unmount(){Rt(e)}}}function In({store:e,children:t,onCreated:n,rootElement:i}){return ge(()=>{const s=e.getState();s.set(a=>({internal:{...a.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),q.jsx(Ct.Provider,{value:e,children:t})}function Rt(e,t){const n=ue.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),Se.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var a,h,g,c;s.events.disconnect==null||s.events.disconnect(),(a=s.gl)==null||(h=a.renderLists)==null||h.dispose==null||h.dispose(),(g=s.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(c=s.gl)!=null&&c.xr&&s.xr.disconnect(),En(s),ue.delete(e)}catch{}},500)})}}Se.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function zn(e){const{handlePointer:t}=Rn(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ze).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:a}=e.getState();a.disconnect==null||a.disconnect(),s(h=>({events:{...h.events,connected:n}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([h,g])=>{const[c,p]=ze[h];n.addEventListener(c,g,{passive:p})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([a,h])=>{if(i&&i.connected instanceof HTMLElement){const[g]=ze[a];i.connected.removeEventListener(g,h)}}),n(a=>({events:{...a.events,connected:void 0}}))}}}}const Hn=d.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:a,events:h=zn,eventSource:g,eventPrefix:c,shadows:p,linear:r,flat:o,legacy:l,orthographic:m,frameloop:v,dpr:P,performance:f,raycaster:u,camera:y,scene:M,onPointerMissed:O,onCreated:C,..._},T){d.useMemo(()=>gn(Qt),[]);const A=cn(),[R,D]=sn({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=d.useRef(null),L=d.useRef(null);d.useImperativeHandle(T,()=>w.current);const N=yt(O),[Z,z]=d.useState(!1),[$,H]=d.useState(!1);if(Z)throw Z;if($)throw $;const b=d.useRef(null);ge(()=>{const E=w.current;D.width>0&&D.height>0&&E&&(b.current||(b.current=Fn(E)),b.current.configure({gl:a,events:h,shadows:p,linear:r,flat:o,legacy:l,orthographic:m,frameloop:v,dpr:P,performance:f,raycaster:u,camera:y,scene:M,size:D,onPointerMissed:(...x)=>N.current==null?void 0:N.current(...x),onCreated:x=>{x.events.connect==null||x.events.connect(g?bn(g)?g.current:g:L.current),c&&x.setEvents({compute:(k,j)=>{const W=k[c+"X"],U=k[c+"Y"];j.pointer.set(W/j.size.width*2-1,-(U/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),C==null||C(x)}}),b.current.render(q.jsx(A,{children:q.jsx(bt,{set:H,children:q.jsx(d.Suspense,{fallback:q.jsx(wn,{set:z}),children:t})})})))}),d.useEffect(()=>{const E=w.current;if(E)return()=>Rt(E)},[]);const S=g?"none":"auto";return q.jsx("div",{ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:S,...s},..._,children:q.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:q.jsx("canvas",{ref:w,style:{display:"block"},children:n})})})}),mr=d.forwardRef(function(t,n){return q.jsx(ln,{children:q.jsx(Hn,{...t,ref:n})})}),be=new V,Ze=new V,Nn=new V,ct=new Ge;function Wn(e,t,n){const i=be.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,a=n.height/2;return[i.x*s+s,-(i.y*a)+a]}function Bn(e,t){const n=be.setFromMatrixPosition(e.matrixWorld),i=Ze.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),a=t.getWorldDirection(Nn);return s.angleTo(a)>Math.PI/2}function $n(e,t,n,i){const s=be.setFromMatrixPosition(e.matrixWorld),a=s.clone();a.project(t),ct.set(a.x,a.y),n.setFromCamera(ct,t);const h=n.intersectObjects(i,!0);if(h.length){const g=h[0].distance;return s.distanceTo(n.ray.origin)<g}return!0}function Un(e,t){if(t instanceof $e)return t.zoom;if(t instanceof Ue){const n=be.setFromMatrixPosition(e.matrixWorld),i=Ze.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,a=n.distanceTo(i);return 1/(2*Math.tan(s/2)*a)}else return 1}function Gn(e,t,n){if(t instanceof Ue||t instanceof $e){const i=be.setFromMatrixPosition(e.matrixWorld),s=Ze.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(s),h=(n[1]-n[0])/(t.far-t.near),g=n[1]-h*t.far;return Math.round(h*a+g)}}const Be=e=>Math.abs(e)<1e-10?0:e;function Ot(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Be(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Vn=(e=>t=>Ot(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),qn=(e=>(t,n)=>Ot(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Zn(e){return e&&typeof e=="object"&&"current"in e}const hr=d.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:a,fullscreen:h,portal:g,distanceFactor:c,sprite:p=!1,transform:r=!1,occlude:o,onOcclude:l,castShadow:m,receiveShadow:v,material:P,geometry:f,zIndexRange:u=[16777271,0],calculatePosition:y=Wn,as:M="div",wrapperClass:O,pointerEvents:C="auto",..._},T)=>{const{gl:A,camera:R,scene:D,size:w,raycaster:L,events:N,viewport:Z}=B(),[z]=d.useState(()=>document.createElement(M)),$=d.useRef(),H=d.useRef(null),b=d.useRef(0),S=d.useRef([0,0]),E=d.useRef(null),x=d.useRef(null),k=(g==null?void 0:g.current)||N.connected||A.domElement.parentNode,j=d.useRef(null),W=d.useRef(!1),U=d.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Zn(o[0]),[o]);d.useLayoutEffect(()=>{const G=A.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(u[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),d.useLayoutEffect(()=>{if(H.current){const G=$.current=fn(z);if(D.updateMatrixWorld(),r)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=y(H.current,R,w);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return k&&(s?k.prepend(z):k.appendChild(z)),()=>{k&&k.removeChild(z),G.unmount()}}},[k,r]),d.useLayoutEffect(()=>{O&&(z.className=O)},[O]);const X=d.useMemo(()=>r?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...n},[n,a,h,w,r]),ne=d.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);d.useLayoutEffect(()=>{if(W.current=!1,r){var G;(G=$.current)==null||G.render(d.createElement("div",{ref:E,style:X},d.createElement("div",{ref:x,style:ne},d.createElement("div",{ref:T,className:i,style:n,children:e}))))}else{var I;(I=$.current)==null||I.render(d.createElement("div",{ref:T,style:X,className:i,children:e}))}});const re=d.useRef(!0);fe(G=>{if(H.current){R.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const I=r?S.current:y(H.current,R,w);if(r||Math.abs(b.current-R.zoom)>t||Math.abs(S.current[0]-I[0])>t||Math.abs(S.current[1]-I[1])>t){const K=Bn(H.current,R);let Y=!1;U&&(Array.isArray(o)?Y=o.map(J=>J.current):o!=="blending"&&(Y=[D]));const de=re.current;if(Y){const J=$n(H.current,R,L,Y);re.current=J&&!K}else re.current=!K;de!==re.current&&(l?l(!re.current):z.style.display=re.current?"block":"none");const we=Math.floor(u[0]/2),kt=o?U?[u[0],we]:[we-1,0]:u;if(z.style.zIndex=`${Gn(H.current,R,kt)}`,r){const[J,Ke]=[w.width/2,w.height/2],xe=R.projectionMatrix.elements[5]*Ke,{isOrthographicCamera:Je,top:At,left:Lt,bottom:Dt,right:Ft}=R,It=Vn(R.matrixWorldInverse),zt=Je?`scale(${xe})translate(${Be(-(Ft+Lt)/2)}px,${Be((At+Dt)/2)}px)`:`translateZ(${xe}px)`;let Q=H.current.matrixWorld;p&&(Q=R.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(H.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),z.style.width=w.width+"px",z.style.height=w.height+"px",z.style.perspective=Je?"":`${xe}px`,E.current&&x.current&&(E.current.style.transform=`${zt}${It}translate(${J}px,${Ke}px)`,x.current.style.transform=qn(Q,1/((c||10)/400)))}else{const J=c===void 0?1:Un(H.current,R)*c;z.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${J})`}S.current=I,b.current=R.zoom}}if(!U&&j.current&&!W.current)if(r){if(E.current){const I=E.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:K}=R;if(K||f)_.scale&&(Array.isArray(_.scale)?_.scale instanceof V?j.current.scale.copy(_.scale.clone().divideScalar(1)):j.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):j.current.scale.setScalar(1/_.scale));else{const Y=(c||10)/400,de=I.clientWidth*Y,we=I.clientHeight*Y;j.current.scale.set(de,we,1)}W.current=!0}}}else{const I=z.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const K=1/Z.factor,Y=I.clientWidth*K,de=I.clientHeight*K;j.current.scale.set(Y,de,1),W.current=!0}j.current.lookAt(G.camera.position)}});const Ye=d.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return d.createElement("group",te({},_,{ref:H}),o&&!U&&d.createElement("mesh",{castShadow:m,receiveShadow:v,ref:j},f||d.createElement("planeGeometry",null),P||d.createElement("shaderMaterial",{side:en,vertexShader:Ye.vertexShader,fragmentShader:Ye.fragmentShader})))});let me=0;const gr=pt(e=>(_e.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-me)/(i-me)*100})},_e.onLoad=()=>{e({active:!1})},_e.onError=t=>e(n=>({errors:[...n.errors,t]})),_e.onProgress=(t,n,i)=>{n===i&&(me=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-me)/(i-me)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Xn=()=>parseInt(tn.replace(/\D+/g,"")),Yn=Xn();let Me=null,jt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Tt(e,t,n){return i=>{n&&n(i),e&&(Me||(Me=new dn),Me.setDecoderPath(typeof e=="string"?e:jt),i.setDRACOLoader(Me)),t&&i.setMeshoptDecoder(typeof je=="function"?je():je)}}function Xe(e,t=!0,n=!0,i){return ye(Ve,e,Tt(t,n,i))}Xe.preload=(e,t=!0,n=!0,i)=>ye.preload(Ve,e,Tt(t,n,i));Xe.clear=e=>ye.clear(Ve,e);Xe.setDecoderPath=e=>{jt=e};const yr=d.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:s=!0,keyEvents:a=!1,onChange:h,onStart:g,onEnd:c,...p},r)=>{const o=B(_=>_.invalidate),l=B(_=>_.camera),m=B(_=>_.gl),v=B(_=>_.events),P=B(_=>_.setEvents),f=B(_=>_.set),u=B(_=>_.get),y=B(_=>_.performance),M=t||l,O=i||v.connected||m.domElement,C=d.useMemo(()=>new pn(M),[M]);return fe(()=>{C.enabled&&C.update()},-1),d.useEffect(()=>(a&&C.connect(a===!0?O:a),C.connect(O),()=>void C.dispose()),[a,O,n,C,o]),d.useEffect(()=>{const _=R=>{o(),n&&y.regress(),h&&h(R)},T=R=>{g&&g(R)},A=R=>{c&&c(R)};return C.addEventListener("change",_),C.addEventListener("start",T),C.addEventListener("end",A),()=>{C.removeEventListener("start",T),C.removeEventListener("end",A),C.removeEventListener("change",_)}},[h,g,c,C,o,P]),d.useEffect(()=>{if(e){const _=u().controls;return f({controls:C}),()=>f({controls:_})}},[e,C]),d.createElement("primitive",te({ref:r,object:C,enableDamping:s},p))});function br(e,t,...n){const i=d.useRef(),s=B(a=>a.scene);return d.useLayoutEffect(()=>{let a;if(e&&e!=null&&e.current&&t&&(i.current=a=new t(e.current,...n)),a)return a.traverse(h=>h.raycast=()=>null),s.add(a),()=>{i.current=void 0,s.remove(a),a.dispose==null||a.dispose()}},[s,t,e,...n]),fe(()=>{var a;return void((a=i.current)==null||a.update==null?void 0:a.update())}),i}class Kn extends nn{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new V(0,0,0)},lightColor:{value:new dt("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new Ge(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${Yn>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}function Jn({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:i,color:s="white",distance:a=5,angle:h=.15,attenuation:g=5,anglePower:c=5}){const p=d.useRef(null),r=B(f=>f.size),o=B(f=>f.camera),l=B(f=>f.viewport.dpr),[m]=d.useState(()=>new Kn),[v]=d.useState(()=>new V);t=t===void 0?.1:t,n=n===void 0?h*7:n,fe(()=>{m.uniforms.spotPosition.value.copy(p.current.getWorldPosition(v)),p.current.lookAt(p.current.parent.target.getWorldPosition(v))});const P=d.useMemo(()=>{const f=new rn(t,n,a,128,64,!0);return f.applyMatrix4(new He().makeTranslation(0,-a/2,0)),f.applyMatrix4(new He().makeRotationX(-Math.PI/2)),f},[a,t,n]);return d.createElement(d.Fragment,null,d.createElement("mesh",{ref:p,geometry:P,raycast:()=>null},d.createElement("primitive",{object:m,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":s,"uniforms-attenuation-value":g,"uniforms-anglePower-value":c,"uniforms-depth-value":i,"uniforms-cameraNear-value":o.near,"uniforms-cameraFar-value":o.far,"uniforms-resolution-value":i?[r.width*l,r.height*l]:[0,0]})))}const wr=d.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:i,color:s="white",distance:a=5,angle:h=.15,attenuation:g=5,anglePower:c=5,volumetric:p=!0,debug:r=!1,children:o,...l},m)=>{const v=d.useRef(null);return d.useImperativeHandle(m,()=>v.current,[]),d.createElement("group",null,r&&v.current&&d.createElement("spotLightHelper",{args:[v.current]}),d.createElement("spotLight",te({ref:v,angle:h,color:s,distance:a,castShadow:!0},l),p&&d.createElement(Jn,{debug:r,opacity:e,radiusTop:t,radiusBottom:n,depthBuffer:i,color:s,distance:a,angle:h,attenuation:g,anglePower:c})),o&&d.cloneElement(o,{spotlightRef:v,debug:r}))});let ee,he;const Qn=d.createContext(null),ut=new He,ft=new V,er=d.forwardRef(({children:e,range:t,limit:n=1e3,...i},s)=>{const a=d.useRef(null);d.useImperativeHandle(s,()=>a.current,[]);const[h,g]=d.useState([]),[[c,p,r]]=d.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);d.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),fe(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),ut.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,h.length),ee=0;ee<h.length;ee++)he=h[ee].current,he.getWorldPosition(ft).applyMatrix4(ut),ft.toArray(c,ee*3),a.current.geometry.attributes.position.needsUpdate=!0,he.matrixWorldNeedsUpdate=!0,he.color.toArray(p,ee*3),a.current.geometry.attributes.color.needsUpdate=!0,r.set([he.size],ee),a.current.geometry.attributes.size.needsUpdate=!0});const o=d.useMemo(()=>({getParent:()=>a,subscribe:l=>(g(m=>[...m,l]),()=>g(m=>m.filter(v=>v.current!==l.current)))}),[]);return d.createElement("points",te({userData:{instances:h},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-color",count:p.length/3,array:p,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:ce})),d.createElement(Qn.Provider,{value:o},e))}),tr=d.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:s=3,...a},h)=>{const g=d.useRef(null);return d.useImperativeHandle(h,()=>g.current,[]),fe(()=>{const c=g.current.geometry.attributes;c.position.needsUpdate=!0,n&&(c.color.needsUpdate=!0),i&&(c.size.needsUpdate=!0)}),d.createElement("points",te({ref:g},a),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ce}),n&&d.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/s,array:n,itemSize:3,usage:ce}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ce})),e)}),_r=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(tr,te({},e,{ref:t})):d.createElement(er,te({},e,{ref:t})));function Pr({all:e,scene:t,camera:n}){const i=B(({gl:h})=>h),s=B(({camera:h})=>h),a=B(({scene:h})=>h);return d.useLayoutEffect(()=>{const h=[];e&&(t||a).traverse(p=>{p.visible===!1&&(h.push(p),p.visible=!0)}),i.compile(t||a,n||s);const g=new on(128);new an(.01,1e5,g).update(i,t||a),g.dispose(),h.forEach(p=>p.visible=!1)},[]),null}export{mr as C,hr as H,yr as O,Pr as P,wr as S,vr as a,Xe as b,br as c,fe as d,_r as e,pr as g,gr as u};
